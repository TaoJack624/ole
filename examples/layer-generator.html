<!DOCTYPE html>
<html>
<head>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,IE=11" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
    <link rel="shortcut icon" href="../favicon.ico" type="image/x-icon">
    <link rel="icon" href="../favicon.ico" type="image/x-icon">

    <title>ArcGIS REST from Capabilities example</title>
    <script src="https://code.jquery.com/jquery-1.11.2.min.js"></script>

    <script src="./head.js"></script>

</head>
<body>
<div class="container-fluid">

<div class="row-fluid">
  <div class="span12">
    <input id="caps-url" value="http://sampleserver1.arcgisonline.com/ArcGIS/rest/services/Specialty/ESRI_StateCityHighway_USA/MapServer" style="width:800px"></input>
    <button id="get-caps">Connect</button>
    <div id="map" class="map"></div>
  </div>
</div>

</div>
<script>

  import {Map, View} from "ol";
  import {defaults as default_controls} from "ol/control";
  import {MousePosition} from "ol/control";

  (function() {
  var map;
  document.getElementById('get-caps').addEventListener('click', function() {
    var capsUrl = document.getElementById('caps-url').value;
    if (capsUrl.charAt(capsUrl.length - 1) === '?') {
      capsUrl = capsUrl.substring(0, capsUrl.length - 1);
    }
    $.ajax({
      url: capsUrl,
      jsonp: 'callback',
      dataType: 'jsonp',
      data: {
        f: 'json'
      },
      success: function(config) {
        if (config.error) {
          alert(config.error.message + '\n' +
              config.error.details.join('\n'));
        } else {
          var generator = new ole.LayerGenerator({config: config, url: capsUrl});
          var layer = generator.createLayer();
          var fullExtent = generator.getFullExtent();
          var resolutions = generator.getResolutions();
          var projection = generator.getProjection();
          if (!map) {
            map = new Map({
              controls: default_controls().extend([
                new MousePosition()]),
              layers: [layer],
              target: 'map',
              view: new View({
                resolutions: resolutions,
                projection: projection
              })
            });
          } else {
            map.getLayers().clear();
            map.setView(new View({
              resolutions: resolutions,
              projection: projection
            }));
            map.addLayer(layer);
          }
          map.getView().fit(fullExtent, map.getSize());
        }
      }
    });
  });
})();
</script>
</body>
</html>
